<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Camp Lip Sync Check-In</title>

<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">

<!-- Tailwind CSS -->
<script defer src="https://cdn.tailwindcss.com"></script>
<script>
  document.fonts.ready.then(() => document.documentElement.classList.add('fonts-loaded'));
</script>
<!-- QR Scanner script -->
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
html { opacity: 0; transition: opacity .3s ease-in; font-size: clamp(14px,2vw,17px); }
html.fonts-loaded { opacity:1; }
body {
  margin:0; min-height:100%; font-family:'Inter',sans-serif; color:white; background:black;
  -webkit-user-select:none; touch-action:manipulation; overflow-x:hidden;
}
#bg-video {
  position:fixed; top:0; left:0; width:100vw; height:100vh;
  object-fit:cover; z-index:0; opacity:.8;
}
.screen {
  position:relative; min-height:100vh;
  display:flex; align-items:center; justify-content:center;
  flex-direction:column; padding:2rem 1rem; z-index:10;
}
.hidden { opacity:0!important; pointer-events:none; }
.glass-card {
  background:rgba(0,0,0,.45); backdrop-filter:blur(20px);
  border-radius:1.25rem; border:1px solid rgba(255,255,255,.15);
  width:100%; max-width:420px; overflow:hidden;
}
button, select, input {
  border-radius:.75rem; border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.1); color:white; text-align:center;
  width:100%; padding:1rem; font-size:1.1rem;
}
button:hover { background:rgba(255,255,255,.15); }
@keyframes pink-green-glow {
  0% { box-shadow:0 0 10px 1px rgba(255,105,180,.6); }
  50% { box-shadow:0 0 18px 3px rgba(96,163,77,.8); }
  100% { box-shadow:0 0 10px 1px rgba(255,105,180,.6); }
}
button.glow { animation:pink-green-glow 6s ease-in-out infinite; }
.success { color:#22c55e; font-weight:600; }
.error { color:#f87171; font-weight:600; }
.warning { color:#fde047; font-weight:600; }
#counts {
  margin-top:.75rem; color:#ffffff; font-weight:600; font-size:1.05rem;
  text-align:center;
}
</style>
</head>

<body>
<video autoplay muted playsinline loop preload="auto" id="bg-video">
  <source src="https://firebasestorage.googleapis.com/v0/b/lip-sync-2025.firebasestorage.app/o/mAzP2S1%20-%20Imgur.mp4?alt=media&token=dc264640-a95e-4494-9d27-83ab5380a1a6" type="video/mp4">
</video>

<div id="main-screen" class="screen">
  <div class="glass-card text-center p-6 shadow-2xl">
    <img src="https://firebasestorage.googleapis.com/v0/b/lip-sync-2025.firebasestorage.app/o/EnuWGLA%20-%20Imgur.png?alt=media&token=c06a0ce1-d2e3-4cde-ac4a-a5ba89142b30"
         alt="Camp Lip Sync" class="w-full max-w-[240px] mb-5 mx-auto">

    <h2 class="text-xl font-semibold mb-2">Camp Lip Sync Check-In</h2>
    <p class="text-white/70 text-sm mb-6">Select a session and check-in method below.</p>

    <div class="w-full flex justify-center mb-5">
      <select id="session" class="text-center font-semibold max-w-[260px]">
        <option value="First Check-In">First Check-In</option>
        <option value="Second Check-In">Second Check-In</option>
        <option value="Final Check-In">Final Check-In</option>
      </select>
    </div>

    <div class="flex flex-col gap-3 mb-5">
      <button id="mode-scan" class="glow border border-white/40 rounded-lg py-3 text-lg font-semibold">Scan QR</button>
      <button id="mode-id" class="border border-white/40 rounded-lg py-3 text-lg font-semibold">Enter Student ID</button>
      <button id="mode-name" class="border border-white/40 rounded-lg py-3 text-lg font-semibold">Search by Name</button>
    </div>

    <p id="status" class="mt-3 min-h-[2rem] text-base"></p>
    <div id="counts">Total Campers Checked In: 0 / 300</div>
  </div>
</div>

<!-- QR Card -->
<div id="qr-screen" class="screen hidden">
  <div class="glass-card text-center p-6 shadow-2xl">
    <h3 class="text-lg font-semibold mb-4">Scan QR Code</h3>
    <div id="reader" class="w-full max-w-[320px] rounded-xl overflow-hidden border border-white/20 mb-4"></div>
    <button id="stop-scan" class="border border-white/40 rounded-lg py-2 text-base mb-4">Cancel</button>
    <p id="status-qr" class="text-base"></p>
  </div>
</div>

<!-- ID Entry Card -->
<div id="id-screen" class="screen hidden">
  <div class="glass-card text-center p-6 shadow-2xl">
    <h3 class="text-lg font-semibold mb-4">Enter Student ID</h3>
    <input type="text" id="student-id" placeholder="Student ID" class="mb-3">
    <button id="submit-id" class="border border-white/40 rounded-lg py-2 text-base mb-4">Submit</button>
    <p id="status-id" class="text-base"></p>
  </div>
</div>

<!-- Name Entry Card -->
<div id="name-screen" class="screen hidden">
  <div class="glass-card text-center p-6 shadow-2xl">
    <h3 class="text-lg font-semibold mb-4">Search by Name</h3>
    <input type="text" id="first-name" placeholder="First Name" class="mb-2">
    <input type="text" id="last-name" placeholder="Last Name" class="mb-3">
    <button id="submit-name" class="border border-white/40 rounded-lg py-2 text-base mb-4">Submit</button>
    <p id="status-name" class="text-base"></p>
  </div>
</div>

<!-- Confirmation Card -->
<div id="confirm-screen" class="screen hidden">
  <div class="glass-card text-center p-6 shadow-2xl">
    <h3 class="text-2xl font-bold mb-3 text-white">âœ… Check-In Complete</h3>
    <p id="confirm-name" class="text-white text-base mb-4"></p>
    <button id="confirm-back" class="border border-white/40 rounded-lg py-2 text-base">Back to Check-In</button>
  </div>
</div>

<audio id="success-sound" preload="auto">
  <source src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" type="audio/ogg">
</audio>
<audio id="error-sound" preload="auto">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzGsd32be0V0rypH6zHpETo7ZLqwENfQxGRGv3x8nKO3WkRaC03UnnkmiLXYr9gaEt1/exec";

let html5QrCode = null;
const statusEl = document.getElementById("status");
const countsEl = document.getElementById("counts");
const successSound = document.getElementById("success-sound");
const errorSound = document.getElementById("error-sound");

// Screen navigation
function showScreen(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  statusEl.textContent = "";
}
document.getElementById("mode-scan").onclick = () => showScreen("qr-screen") || startScanner();
document.getElementById("mode-id").onclick = () => showScreen("id-screen");
document.getElementById("mode-name").onclick = () => showScreen("name-screen");
document.getElementById("confirm-back").onclick = () => showScreen("main-screen");

// Scanner logic
function startScanner(){
  if(html5QrCode) return;
  html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start({ facingMode:"environment" }, { fps:10, qrbox:250 },
    id=>{
      html5QrCode.stop().catch(()=>{});
      html5QrCode=null;
      submitCheckIn({ id });
    },
    err => {}
  );
}
document.getElementById("stop-scan").onclick = () => {
  if(html5QrCode) html5QrCode.stop().catch(()=>{ html5QrCode=null; });
  showScreen("main-screen");
};

// Submit functions
document.getElementById("submit-id").onclick = () => {
  const id = document.getElementById("student-id").value.trim();
  if(!id) { document.getElementById("status-id").textContent = "Please enter an ID."; return; }
  submitCheckIn({ id });
};
document.getElementById("submit-name").onclick = () => {
  const first = document.getElementById("first-name").value.trim();
  const last = document.getElementById("last-name").value.trim();
  if(!first || !last) { document.getElementById("status-name").textContent = "Enter both first and last name."; return; }
  submitCheckIn({ first, last });
};

function submitCheckIn(payload){
  const session = document.getElementById("session").value;
  fetch(scriptURL, {
    method:"POST",
    body: JSON.stringify({ ...payload, session })
  })
  .then(r=>r.json())
  .then(data=>{
    if(data.message && data.first && data.last){
      successSound.play().catch(()=>{});
      document.getElementById("confirm-name").textContent = data.first + " " + data.last;
      showScreen("confirm-screen");
      updateCounts(data.counts);
    } else {
      errorSound.play().catch(()=>{});
      const errMsg = (data && data.message) ? data.message : "Check-in failed.";
      statusEl.textContent = errMsg;
    }
  })
  .catch(()=>{
    errorSound.play().catch(()=>{});
    statusEl.textContent = "Network error. Try again.";
  });
}

function updateCounts(counts){
  countsEl.textContent = `Total Campers Checked In: ${counts.Total} / 300`;
}

// Initial count load
fetch(scriptURL, { method:"POST", body: JSON.stringify({ mode:"count" }) })
  .then(r=>r.json()).then(updateCounts).catch(()=>{ countsEl.textContent = "Total Campers Checked In: 0 / 300"; });
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const video = document.getElementById('bg-video');
  let ok = false;
  video.play().then(() => ok = true).catch(()=>{});
  setTimeout(() => {
    if(!ok || video.paused){
      document.head.insertAdjacentHTML('beforeend',
        `<style>body{background:radial-gradient(circle at 50% 20%,#111 0%,#000 100%)!important;}#bg-video{display:none!important;}</style>`
      );
    }
  }, 1200);
});
</script>

</body>
</html>
